{"code":"!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){n(1),function(){var e=new Error(\"Cannot find module 'bundle.js'\");throw e.code=\"MODULE_NOT_FOUND\",e}()},function(e,t,n){const o=n(2),r=n(3),i=n(4),u=n(5);let l=null;class s{constructor(e,t,n){this.id=e,this.nodes=t,this.color=null,this.byzantine=n,this.sampleSize=10,this.alpha=.8,this.beta=15,this.messageCount=0}updateColor(e){e!=this.color&&(console.log((this.byzantine?\"[B] \":\"\")+this.id+\": \"+this.color+\" -> \"+e),this.color=e,this.nodes.update({id:this.id,color:{background:e},borderWidth:this.byzantine?2:0}))}byzantineColor(e){return\"rgb(0, 0, 255)\"}}function c(){return`rgb(${Math.floor(256*Math.random())},${Math.floor(256*Math.random())},${Math.floor(256*Math.random())})`}window.resetView=function(e,t,n,a,h,f=null){null!==l&&(clearInterval(l),l=null);let d=[];for(let e=1;e<=n;e++)d.push({id:e,label:\"\"+e});let p=new vis.DataSet(d),y=new vis.DataSet([]),b=d.map(e=>({userContext:new s(e.id,p,Math.random()<a)})),v=null;switch(t){case\"slush\":v=new r.SlushBuilder;break;case\"snowflake\":v=new i.SnowflakeBuilder;break;case\"snowball\":v=new u.SnowballBuilder;break;default:throw new Error(\"invalid policy\")}let w=new o.Network(b,v);for(let e=0;e<h;e++)w.nodes[Math.floor(Math.random()*w.nodes.length)].policy.color=c();new vis.Network(e,{nodes:p,edges:y},{nodes:{color:{background:\"rgb(200, 200, 200)\",border:\"rgb(0, 0, 0)\"},shape:\"dot\",size:10,borderWidth:0},layout:{improvedLayout:!1}}),l=setInterval(()=>{w.tick();let e=!0;for(let t of w.nodes)if(!t.config.userContext.byzantine&&!t.policy.decided){e=!1;break}e&&(console.log(\"All correct nodes are decided.\"),null!==l&&(clearInterval(l),l=null),f&&f())},200)}},function(e,t,n){\"use strict\";t.__esModule=!0;var o=function(){};t.NodeConfig=o;var r=function(e,t){this.config=e,this.policy=t,this.shuffledRequestQueue=[]},i=function(){function e(e,t){this.nodes=e.map(function(e){return new r(e,t.buildPolicy())})}return e.prototype.randomlySampleNodes=function(e){var t=this.nodes.map(function(e){return e});return u(t),e>t.length&&(e=t.length),t.slice(0,e)},e.prototype.tick=function(){for(var e=0,t=this.nodes;e<t.length;e++){for(var n=(a=t[e]).policy.requestQueue.length,o=0,r=a.policy.requestQueue;o<r.length;o++){var i=r[o];a.shuffledRequestQueue.push(i)}u(a.shuffledRequestQueue);var l=Math.floor(2*n*Math.random());l<100&&(l=100),l>a.shuffledRequestQueue.length&&(l=a.shuffledRequestQueue.length),a.policy.requestQueue=a.shuffledRequestQueue.splice(0,l),a.policy.query(a.config.userContext)}for(var s=0,c=this.nodes;s<c.length;s++){var a;(a=c[s]).policy.tick(a.config.userContext,this)}},e}();function u(e){for(var t,n=e.length-1;n>0;n--){var o=Math.floor(Math.random()*(n+1));t=[e[o],e[n]],e[n]=t[0],e[o]=t[1]}}t.Network=i},function(e,t,n){\"use strict\";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function u(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(u,l)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};t.__esModule=!0;var i=function(){function e(e){this.color=e,this.resolve=null}return e.prototype.getPromise=function(){var e=this;return new Promise(function(t){e.resolve=t})},e}(),u=function(){function e(){this.color=null,this.requestQueue=[]}return e.prototype.query=function(e){for(var t=0,n=this.requestQueue;t<n.length;t++){var o=n[t];this.color||(this.color=o.color),e.byzantine?o.resolve(e.byzantineColor(this.color)):o.resolve(this.color)}e.messageCount+=this.requestQueue.length,this.requestQueue=[]},e.prototype.tick=function(e,t){return o(this,void 0,void 0,function(){var n,o,u,l,s,c,a,h=this;return r(this,function(r){switch(r.label){case 0:return this.color?(n=t.randomlySampleNodes(e.sampleSize),[4,Promise.all(n.map(function(e){var t=new i(h.color);return e.policy.requestQueue.push(t),t.getPromise()}))]):[2];case 1:for(o=r.sent(),u=new Map,l=0,s=o;l<s.length;l++)if(c=s[l],(a=u.get(c))||(a=0),a++,u.set(c,a),a>=e.alpha*n.length){this.color=c;break}return e.updateColor(this.color),[2]}})})},e}();t.Slush=u;var l=function(){function e(){}return e.prototype.buildPolicy=function(){return new u},e}();t.SlushBuilder=l},function(e,t,n){\"use strict\";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function u(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(u,l)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};t.__esModule=!0;var i=function(){function e(e){this.color=e,this.resolve=null}return e.prototype.getPromise=function(){var e=this;return new Promise(function(t){e.resolve=t})},e}(),u=function(){function e(){this.color=null,this.requestQueue=[],this.cnt=0,this.decided=!1}return e.prototype.query=function(e){for(var t=0,n=this.requestQueue;t<n.length;t++){var o=n[t];this.color||(this.color=o.color),e.byzantine?o.resolve(e.byzantineColor(this.color)):o.resolve(this.color)}e.messageCount+=this.requestQueue.length,this.requestQueue=[]},e.prototype.tick=function(e,t){return o(this,void 0,void 0,function(){var n,o,u,l,s,c,a,h=this;return r(this,function(r){switch(r.label){case 0:return this.decided?[2]:this.color?(n=t.randomlySampleNodes(e.sampleSize),[4,Promise.all(n.map(function(e){var t=new i(h.color);return e.policy.requestQueue.push(t),t.getPromise()}))]):[2];case 1:for(o=r.sent(),u=new Map,l=0,s=o;l<s.length;l++)if(c=s[l],a=(u.get(c)||0)+1,u.set(c,a),a>=e.alpha*n.length){this.color!=c?this.cnt=0:(this.cnt++,this.cnt>e.beta&&(this.decided=!0)),this.color=c;break}return e.updateColor(this.color),[2]}})})},e}();t.Snowflake=u;var l=function(){function e(){}return e.prototype.buildPolicy=function(){return new u},e}();t.SnowflakeBuilder=l},function(e,t,n){\"use strict\";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function u(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(u,l)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};t.__esModule=!0;var i=function(){function e(e){this.color=e,this.resolve=null}return e.prototype.getPromise=function(){var e=this;return new Promise(function(t){e.resolve=t})},e}(),u=function(){function e(){this.color=null,this.lastColor=null,this.colorCnt=new Map,this.requestQueue=[],this.cnt=0,this.decided=!1}return e.prototype.query=function(e){for(var t=0,n=this.requestQueue;t<n.length;t++){var o=n[t];this.color||(this.color=o.color),e.byzantine?o.resolve(e.byzantineColor(this.color)):o.resolve(this.color)}e.messageCount+=this.requestQueue.length,this.requestQueue=[]},e.prototype.tick=function(e,t){return o(this,void 0,void 0,function(){var n,o,u,l,s,c,a,h,f=this;return r(this,function(r){switch(r.label){case 0:return this.decided?[2]:this.color?(n=t.randomlySampleNodes(e.sampleSize),[4,Promise.all(n.map(function(e){var t=new i(f.color);return e.policy.requestQueue.push(t),t.getPromise()}))]):[2];case 1:for(o=r.sent(),u=new Map,l=0,s=o;l<s.length;l++)if(c=s[l],a=(u.get(c)||0)+1,u.set(c,a),a>=e.alpha*n.length){h=(this.colorCnt.get(c)||0)+1,this.colorCnt.set(c,h),h>(this.colorCnt.get(this.color)||0)&&(this.color=c),this.lastColor!=c?(this.lastColor=c,this.cnt=0):(this.cnt++,this.cnt>e.beta&&(this.decided=!0));break}return e.updateColor(this.color),[2]}})})},e}();t.Snowball=u;var l=function(){function e(){}return e.prototype.buildPolicy=function(){return new u},e}();t.SnowballBuilder=l}]);","extractedComments":[]}